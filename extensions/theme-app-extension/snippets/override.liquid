{% if "product" contains request.page_type %}
  <style>
    [msell-vd-blur]{
      opacity: 0 !important;
    }
  </style>
	<script id="msell-script-vd">
		let metafieldsMS = {{ shop.metafields.msAppBlock | json }};
    let isDesignModeMS = '{{request.design_mode}}';
		if((!isDesignModeMS || isDesignModeMS == 'false') && metafieldsMS[`offer_check_{{product.id}}`]){
			const buttonsMS = ['form[data-type="add-to-cart-form"] button[type="submit"]', 'form[data-type="add-to-cart-form"] input[type="submit"]', "form[action$='/cart/add'] .product-buy-buttons--cta", "form[action$='/cart/add'] button[name='add']", "form[action$='/cart/add'] button.add_to_cart", '.product .product-form__buttons button[type="submit"]', '.product .product-form__buttons button[name="add"]', ".product .product-form__buttons .qty-input__btn", ".product .product-form__buttons .single_add_to_cart_button", ".product .product-form__buttons .add-to-cart-btn", ".product .product-form__buttons .product-form__submit", ".product .product-form__buttons .product-form__cart-submit", '.product .product-form button[type="submit"]', '.product .product-form button[name="add"]', ".product .product-form .qty-input__btn", ".product .product-form .single_add_to_cart_button", ".product .product-form .add-to-cart-btn", ".product .product-form .product-form__submit", ".product .product-form .product-form__cart-submit", '.product .product-info__add-to-cart button[type="submit"]', '.product .product-info__add-to-cart button[name="add"]', ".product .product-info__add-to-cart .qty-input__btn", ".product .product-info__add-to-cart .single_add_to_cart_button", ".product .product-info__add-to-cart .add-to-cart-btn", ".product .product-info__add-to-cart .product-form__submit", ".product .product-info__add-to-cart .product-form__cart-submit", '.product .product-add-to-cart-container button[type="submit"]', '.product .product-add-to-cart-container button[name="add"]', ".product .product-add-to-cart-container .qty-input__btn", ".product .product-add-to-cart-container .single_add_to_cart_button", ".product .product-add-to-cart-container .add-to-cart-btn", ".product .product-add-to-cart-container .product-form__submit", ".product .product-add-to-cart-container .product-form__cart-submit", '.product .product-detail__form button[type="submit"]', '.product .product-detail__form button[name="add"]', ".product .product-detail__form .qty-input__btn", ".product .product-detail__form .single_add_to_cart_button", ".product .product-detail__form .add-to-cart-btn", ".product .product-detail__form .product-form__submit", ".product .product-detail__form .product-form__cart-submit", '.product .add_to_cart_holder button[name="add"]', ".product .add_to_cart_holder .qty-input__btn", ".product .add_to_cart_holder .single_add_to_cart_button", ".product .add_to_cart_holder .add-to-cart-btn", ".product .add_to_cart_holder .product-form__submit", ".product .add_to_cart_holder .product-form__cart-submit", '.product .product-form__item button[name="add"]', ".product .product-form__item .qty-input__btn", ".product .product-form__item .single_add_to_cart_button", ".product .product-form__item .add-to-cart-btn", ".product .product-form__item .product-form__submit", ".product .product-form__item .product-form__cart-submit", '.product .payment-buttons button[name="add"]', ".product .payment-buttons .qty-input__btn", ".product .payment-buttons .single_add_to_cart_button", ".product .payment-buttons .add-to-cart-btn", ".product .payment-buttons .product-form__submit", ".product .payment-buttons .product-form__cart-submit", '.product .product-detail__detail button[name="add"]', ".product .product-detail__detail .qty-input__btn", ".product .product-detail__detail .single_add_to_cart_button", ".product .product-detail__detail .add-to-cart-btn", ".product .product-detail__detail .product-form__submit", ".product .product-detail__detail .product-form__cart-submit", '.product .product-content button[name="add"]', ".product .product-content .qty-input__btn", ".product .product-content .single_add_to_cart_button", ".product .product-content .add-to-cart-btn", ".product .product-content .product-form__submit", ".product .product-content .product-form__cart-submit", '.product-page .product-form__buttons button[type="submit"]', '.product-page .product-form__buttons button[name="add"]', ".product-page .product-form__buttons .qty-input__btn", ".product-page .product-form__buttons .single_add_to_cart_button", ".product-page .product-form__buttons .add-to-cart-btn", ".product-page .product-form__buttons .product-form__submit", ".product-page .product-form__buttons .product-form__cart-submit", '.product-page .product-form button[type="submit"]', '.product-page .product-form button[name="add"]', ".product-page .product-form .qty-input__btn", ".product-page .product-form .single_add_to_cart_button", ".product-page .product-form .add-to-cart-btn", ".product-page .product-form .product-form__submit", ".product-page .product-form .product-form__cart-submit", '.product-page .product-info__add-to-cart button[type="submit"]', '.product-page .product-info__add-to-cart button[name="add"]', ".product-page .product-info__add-to-cart .qty-input__btn", ".product-page .product-info__add-to-cart .single_add_to_cart_button", ".product-page .product-info__add-to-cart .add-to-cart-btn", ".product-page .product-info__add-to-cart .product-form__submit", ".product-page .product-info__add-to-cart .product-form__cart-submit", '.product-page .product-add-to-cart-container button[type="submit"]', '.product-page .product-add-to-cart-container button[name="add"]', ".product-page .product-add-to-cart-container .qty-input__btn", ".product-page .product-add-to-cart-container .single_add_to_cart_button", ".product-page .product-add-to-cart-container .add-to-cart-btn", ".product-page .product-add-to-cart-container .product-form__submit", ".product-page .product-add-to-cart-container .product-form__cart-submit", '.product-page .product-detail__form button[type="submit"]', '.product-page .product-detail__form button[name="add"]', ".product-page .product-detail__form .qty-input__btn", ".product-page .product-detail__form .single_add_to_cart_button", ".product-page .product-detail__form .add-to-cart-btn", ".product-page .product-detail__form .product-form__submit", ".product-page .product-detail__form .product-form__cart-submit", '.product-page .add_to_cart_holder button[name="add"]', ".product-page .add_to_cart_holder .qty-input__btn", ".product-page .add_to_cart_holder .single_add_to_cart_button", ".product-page .add_to_cart_holder .add-to-cart-btn", ".product-page .add_to_cart_holder .product-form__submit", ".product-page .add_to_cart_holder .product-form__cart-submit", '.product-page .product-form__item button[name="add"]', ".product-page .product-form__item .qty-input__btn", ".product-page .product-form__item .single_add_to_cart_button", ".product-page .product-form__item .add-to-cart-btn", ".product-page .product-form__item .product-form__submit", ".product-page .product-form__item .product-form__cart-submit", '.product-page .payment-buttons button[name="add"]', ".product-page .payment-buttons .qty-input__btn", ".product-page .payment-buttons .single_add_to_cart_button", ".product-page .payment-buttons .add-to-cart-btn", ".product-page .payment-buttons .product-form__submit", ".product-page .payment-buttons .product-form__cart-submit", '.product-page .product-detail__detail button[name="add"]', ".product-page .product-detail__detail .qty-input__btn", ".product-page .product-detail__detail .single_add_to_cart_button", ".product-page .product-detail__detail .add-to-cart-btn", ".product-page .product-detail__detail .product-form__submit", ".product-page .product-detail__detail .product-form__cart-submit", '.product-page .product-content button[name="add"]', ".product-page .product-content .qty-input__btn", ".product-page .product-content .single_add_to_cart_button", ".product-page .product-content .add-to-cart-btn", ".product-page .product-content .product-form__submit", ".product-page .product-content .product-form__cart-submit", '.product-area .product-form__buttons button[name="add"]', ".product-area .product-form__buttons .qty-input__btn", '.product-area .product-form__buttons button[type="submit"]', ".product-area .product-form__buttons .single_add_to_cart_button", ".product-area .product-form__buttons .add-to-cart-btn", ".product-area .product-form__buttons .product-form__submit", ".product-area .product-form__buttons .product-form__cart-submit", '.product-area .product-form button[type="submit"]', '.product-area .product-form button[name="add"]', ".product-area .product-form .qty-input__btn", ".product-area .product-form .single_add_to_cart_button", ".product-area .product-form .add-to-cart-btn", ".product-area .product-form .product-form__submit", ".product-area .product-form .product-form__cart-submit", '.product-area .product-info__add-to-cart button[type="submit"]', '.product-area .product-info__add-to-cart button[name="add"]', ".product-area .product-info__add-to-cart .qty-input__btn", ".product-area .product-info__add-to-cart .single_add_to_cart_button", ".product-area .product-info__add-to-cart .add-to-cart-btn", ".product-area .product-info__add-to-cart .product-form__submit", ".product-area .product-info__add-to-cart .product-form__cart-submit", '.product-area .product-add-to-cart-container button[type="submit"]', '.product-area .product-add-to-cart-container button[name="add"]', ".product-area .product-add-to-cart-container .qty-input__btn", ".product-area .product-add-to-cart-container .single_add_to_cart_button", ".product-area .product-add-to-cart-container .add-to-cart-btn", ".product-area .product-add-to-cart-container .product-form__submit", ".product-area .product-add-to-cart-container .product-form__cart-submit", '.product-area .product-detail__form button[type="submit"]', '.product-area .product-detail__form button[name="add"]', ".product-area .product-detail__form .qty-input__btn", ".product-area .product-detail__form .single_add_to_cart_button", ".product-area .product-detail__form .add-to-cart-btn", ".product-area .product-detail__form .product-form__submit", ".product-area .product-detail__form .product-form__cart-submit", '.product-area .add_to_cart_holder button[name="add"]', ".product-area .add_to_cart_holder .qty-input__btn", ".product-area .add_to_cart_holder .single_add_to_cart_button", ".product-area .add_to_cart_holder .add-to-cart-btn", ".product-area .add_to_cart_holder .product-form__submit", ".product-area .add_to_cart_holder .product-form__cart-submit", '.product-area .product-form__item button[name="add"]', ".product-area .product-form__item .qty-input__btn", ".product-area .product-form__item .single_add_to_cart_button", ".product-area .product-form__item .add-to-cart-btn", ".product-area .product-form__item .product-form__submit", ".product-area .product-form__item .product-form__cart-submit", '.product-area .payment-buttons button[name="add"]', ".product-area .payment-buttons .qty-input__btn", ".product-area .payment-buttons .single_add_to_cart_button", ".product-area .payment-buttons .add-to-cart-btn", ".product-area .payment-buttons .product-form__submit", ".product-area .payment-buttons .product-form__cart-submit", '.product-area .product-detail__detail button[name="add"]', ".product-area .product-detail__detail .qty-input__btn", ".product-area .product-detail__detail .single_add_to_cart_button", ".product-area .product-detail__detail .add-to-cart-btn", ".product-area .product-detail__detail .product-form__submit", ".product-area .product-detail__detail .product-form__cart-submit", '.product-area .product-content button[name="add"]', ".product-area .product-content .qty-input__btn", ".product-area .product-content .single_add_to_cart_button", ".product-area .product-content .add-to-cart-btn", ".product-area .product-content .product-form__submit", ".product-area .product-content .product-form__cart-submit", '.page-width .product-form__buttons button[type="submit"]', '.page-width .product-form__buttons button[name="add"]', ".page-width .product-form__buttons .qty-input__btn", ".page-width .product-form__buttons .single_add_to_cart_button", ".page-width .product-form__buttons .add-to-cart-btn", ".page-width .product-form__buttons .product-form__submit", ".page-width .product-form__buttons .product-form__cart-submit", '.page-width .product-form button[type="submit"]', '.page-width .product-form button[name="add"]', ".page-width .product-form .qty-input__btn", ".page-width .product-form .single_add_to_cart_button", ".page-width .product-form .add-to-cart-btn", ".page-width .product-form .product-form__submit", ".page-width .product-form .product-form__cart-submit", '.page-width .product-info__add-to-cart button[type="submit"]', '.page-width .product-info__add-to-cart button[name="add"]', ".page-width .product-info__add-to-cart .qty-input__btn", ".page-width .product-info__add-to-cart .single_add_to_cart_button", ".page-width .product-info__add-to-cart .add-to-cart-btn", ".page-width .product-info__add-to-cart .product-form__submit", ".page-width .product-info__add-to-cart .product-form__cart-submit", '.page-width .product-add-to-cart-container button[type="submit"]', '.page-width .product-add-to-cart-container button[name="add"]', ".page-width .product-add-to-cart-container .qty-input__btn", ".page-width .product-add-to-cart-container .single_add_to_cart_button", ".page-width .product-add-to-cart-container .add-to-cart-btn", ".page-width .product-add-to-cart-container .product-form__submit", ".page-width .product-add-to-cart-container .product-form__cart-submit", '.page-width .product-detail__form button[type="submit"]', '.page-width .product-detail__form button[name="add"]', ".page-width .product-detail__form .qty-input__btn", ".page-width .product-detail__form .single_add_to_cart_button", ".page-width .product-detail__form .add-to-cart-btn", ".page-width .product-detail__form .product-form__submit", ".page-width .product-detail__form .product-form__cart-submit", '.page-width .add_to_cart_holder button[name="add"]', ".page-width .add_to_cart_holder .qty-input__btn", ".page-width .add_to_cart_holder .single_add_to_cart_button", ".page-width .add_to_cart_holder .add-to-cart-btn", ".page-width .add_to_cart_holder .product-form__submit", ".page-width .add_to_cart_holder .product-form__cart-submit", '.page-width .product-form__item button[name="add"]', ".page-width .product-form__item .qty-input__btn", ".page-width .product-form__item .single_add_to_cart_button", ".page-width .product-form__item .add-to-cart-btn", ".page-width .product-form__item .product-form__submit", ".page-width .product-form__item .product-form__cart-submit", '.page-width .payment-buttons button[name="add"]', ".page-width .payment-buttons .qty-input__btn", ".page-width .payment-buttons .single_add_to_cart_button", ".page-width .payment-buttons .add-to-cart-btn", ".page-width .payment-buttons .product-form__submit", ".page-width .payment-buttons .product-form__cart-submit", '.page-width .product-detail__detail button[name="add"]', ".page-width .product-detail__detail .qty-input__btn", ".page-width .product-detail__detail .single_add_to_cart_button", ".page-width .product-detail__detail .add-to-cart-btn", ".page-width .product-detail__detail .product-form__submit", ".page-width .product-detail__detail .product-form__cart-submit", '.page-width .product-content button[name="add"]', ".page-width .product-content .qty-input__btn", ".page-width .product-content .single_add_to_cart_button", ".page-width .product-content .add-to-cart-btn", ".page-width .product-content .product-form__submit", ".page-width .product-content .product-form__cart-submit", ".product-block-list .product-form__buy-buttons .product-form__add-button", "form[action$='/cart/add'] button[type='submit']", "form[action$='/cart/add'] input[type='submit']", "form[action$='/cart/add'] .product-buy-buttons--primary", "form[action$='/cart/add'] a#add-to-cart-btn.product--addtocart", "form[action$='/cart/add'] product-form__buttons #submitProduct[name='add']", "form[action$='/cart/add'] button.product-submit", "#AddToCart", "form[action$='/cart/add'] .btn--add-to-cart", "form[action$='/cart/add'] .btn-addtocart", "form[action$='/cart/add'] .add", "form[action$='/cart/add'] .add_to_cart", "form[action$='/cart/add'] .product__buy .product__add-to-cart", "form[action$='/cart/add'] .button--addToCart"];
      const selectorOptionsHideMS = [
        '.dbtfy-color_swatches',
        '.product-layout-grid__detail .product-detail__options',
        '.product__info-wrapper variant-radios',
        'div[data-variant-picker]',
        '.product-detail__form__options.product-detail__gap-lg.product-detail__form__options--underlined',
        '.product-block-container .product-block.product-block-variant-picker:not(.pb-card-shadow)',
        '.product-block-container .product-block.product-block-quantity-selector:not(.pb-card-shadow)',
        '.product-form__quantity',
        '.product-block-item.atc-wrapper',
        '.product__quantity',
        '.product-form product-variants',
        '.tt-swatches-container',
        '.product__quantity',
        '.product-info__quantity-selector',
        'variant-picker',
        'product-page product-variants',
        '.product__variants-wrapper.product__block',
        '.product__controls-group-quantity.product__block',
        '.product-options--root',
        'variant-radios',
        '.quantity_selector',
        '.productView-subtotal',
        '.productView-options',
        'f-variant-picker',
        '[data-product-variants]',
        '.product__controls-group-quanity',
        '.yv-product-quantity',
        '.product-block--buy-button .button--sold-out',
        '.container .product__meta[itemscope] div div.row.gy-3',
        ".product__grid__item .product__content .product__selector[id^='ProductSelector-template--']",
        '.product-block .variant-wrapper',
        '.product__info-container variant-radios',
        '.pt-swatches-container.pt-swatches-container-js',
        '.product__info-container variant-selects',
        '.product__info-wrapper variant-selects',
        '.product-page-section variant-selects',
        '.pg__option--single',
        '.product-option-selector'
      ];
      
			function getButtonAddToCartMS(){
				let btnMS = null;
				for(let iMS=0; iMS < buttonsMS.length; iMS++){
					let arrButtonFoundMS = document.querySelectorAll(buttonsMS[iMS]);
					let buttonFoundMS = Array.from(arrButtonFoundMS).find(itemMS => {
            return itemMS && (!itemMS.style || (itemMS.style && itemMS.style.display != "none") || (itemMS.style && itemMS.style.opacity != "0"))
					})
					if(buttonFoundMS){
						btnMS = buttonFoundMS
            break;
					}
				}
				return btnMS
			}
			function logChangesMS(mutations, observer){
				if(document.body){
					let btnCartMS = getButtonAddToCartMS();
					if(btnCartMS){
						let elFormMS = btnCartMS.closest("form")
            if(elFormMS && !elFormMS.getAttribute("msell-vd-blur")){
              window.obVolumeMS.disconnect();
              elFormMS.setAttribute("msell-vd-blur", "1")
              selectorOptionsHideMS.forEach(itemOptionMS => {
                let elOptionMS = document.querySelector(itemOptionMS);
                if(elOptionMS != null && !elOptionMS.getAttribute("msell-vd-blur")){
                  elOptionMS.setAttribute("msell-vd-blur", "1");
                }
              })
              document.getElementById("msell-script-vd")?.remove();
            }
					}
				}
			}
			window.obVolumeMS = new MutationObserver(logChangesMS);
			window.obVolumeMS.observe(document.documentElement, { subtree: true, childList: true });
      setTimeout(() => {
        document.getElementById("msell-script-vd")?.remove();
      }, 4000)
		}
	</script>
{% endif %}